# 도커 이미지와 컨테이너 상세 (0203)

## 1. Docker Image

### 1) 이미지의 구조 (Layer)
*   **유니언 파일 시스템 (Union File System)**: 이미지는 불변(Immutable)의 읽기 전용 레이어들의 집합입니다.
*   **레이어**: 이미지를 구성하는 각 단계. 재사용 가능.
*   `docker image history [이미지명]`: 이미지 구성 레이어 및 크기 조회.
*   **Container Layer**: 이미지 위에 얇은 **읽기/쓰기(Read-Write)** 레이어를 추가하여 컨테이너를 생성합니다. 컨테이너 변경사항은 여기에 저장되며 컨테이너 삭제 시 사라집니다.

### 2) 도커 허브 (Docker Hub) 및 업로드
*   **로그인**: `docker login` (Access Token 사용 권장).
*   **태그 지정**: 업로드를 위해서는 규칙에 맞는 태그가 필요합니다.
    ```bash
    docker tag [원본이미지] [계정명]/[이미지명]:[태전]
    ```
*   **업로드**: `docker push [계정명]/[이미지명]:[버전]`

### 3) 이미지 파일 관리 (Offline)
인터넷이 없는 환경 등으로 이미지를 옮길 때 사용합니다.
*   **저장**: `docker image save [이미지명] > [파일명.tar]`
*   **로드**: `docker image load < [파일명.tar]`
*   압축 사용 시 `.tar.gz` 확장자 사용 가능.

### 4) 이미지 삭제
*   `docker rmi [이미지명]`: 이미지 삭제.
*   `docker image prune -a`: 사용하지 않는(Dangling) 이미지 일괄 삭제.

---

## 2. Docker Container

### 1) 컨테이너는 프로세스다
*   컨테이너는 격리된 공간에서 실행되는 **프로세스**입니다.
*   `docker run` 시 실행되는 프로세스는 **PID 1**번(부모 프로세스)을 가집니다.
*   **생명 주기**:
    *   **실행 (Running)**: CMD/ENTRYPOINT 명령이 실행 중인 상태. 명령이 끝나면 정지됨.
    *   **정지 (Exited)**: 실행 중지 상태. 데이터(RW 레이어)는 유지됨. `start`로 재시작 가능.
    *   **파기 (Deleted)**: `rm`으로 삭제된 상태. 데이터 소멸.

### 2) 주요 관리 명령어
*   **실행**: `docker run [옵션] [이미지]`
    *   `-p`: 포트 포워딩. `-p 8080:80` (호스트 8080 -> 컨테이너 80)
    *   `-v`: 볼륨 마운트.
    *   `-d`: 백그라운드 실행 (Detached).
    *   `-it`: 대화형 터미널 접속.
*   **제어**:
    *   `docker start [컨테이너]`: 정지된 컨테이너 시작.
    *   `docker stop [컨테이너]`: 실행 중인 컨테이너 정상 종료.
    *   `docker attach [컨테이너]`: 실행 중인 컨테이너 터미널에 접속.
    *   `docker exec -it [컨테이너] [명령어]`: 실행 중인 컨테이너에 새로운 명령(bash 등)을 실행. (가장 많이 사용)
*   **정보 확인**:
    *   `docker stats`: 리소스 사용량 실시간 확인.
    *   `docker top`: 컨테이너 내부 프로세스 확인.
    *   `docker logs -f [컨테이너]`: 로그 실시간 확인.

## 3. 컨테이너와 호스트 간 파일 복사 (`docker cp`)

### 명령어
```bash
# 호스트 -> 컨테이너
docker cp [호스트파일] [컨테이너명]:[내부경로]

# 컨테이너 -> 호스트
docker cp [컨테이너명]:[내부경로] [호스트경로]
```

### 실습 예제 (Index.html 수정)
1.  웹 서버 컨테이너 실행: `docker run -d --name web nginx`
2.  파일 꺼내기: `docker cp web:/usr/share/nginx/html/index.html index.html`
3.  파일 수정: 호스트에서 `index.html` 편집.
4.  파일 넣기: `docker cp index.html web:/usr/share/nginx/html/index.html`
5.  확인: `curl localhost` (변경된 내용 확인)
