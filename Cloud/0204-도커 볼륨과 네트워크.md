# 도커 볼륨과 네트워크 (0204)

## 1. 컨테이너 데이터 관리 (Docker Volume)

### 1) 개요
*   컨테이너의 데이터는 컨테이너 삭제 시 소멸됩니다.
*   **목적**: 데이터를 영속적으로 보존하고, 컨테이너 간 데이터를 공유하기 위함.
*   **방식**: Volume (Docker 관리), Bind Mount (호스트 경로 수동 지정).

### 2) 볼륨 마운트 (Volume Mount)
도커 엔진이 관리하는 영역에 볼륨을 생성하여 연결합니다. (가장 권장)
*   **생성**: `docker volume create [볼륨명]`
*   **사용**: `-v [볼륨명]:[컨테이너경로]`
*   **장점**: 백업/관리가 용이하고 컨테이너 간 공유 쉬움.
*   **예시**: MySQL 데이터 보존
    ```bash
    docker run -d -v mysql-data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=pass mysql
    ```

### 3) 바인드 마운트 (Bind Mount)
호스트 컴퓨터의 특정 파일이나 디렉토리를 직접 연결합니다.
*   **사용**: `-v [호스트절대경로]:[컨테이너경로]`
*   **특징**: 호스트에서 파일을 직접 수정하면 컨테이너에 즉시 반영됨 (개발 시 소스 코드 연결 등에 유용).
*   **예시**: 웹 서버 로그/설정 파일 연결
    ```bash
    docker run -d -v /home/user/logs:/var/log/nginx nginx
    ```

---

## 2. Docker 이미지 생성 (`docker commit`)
실행 중인 컨테이너의 상태를 그대로 이미지로 저장할 수 있습니다.
*   **명령**: `docker commit [옵션] [컨테이너] [이미지명]:[태그]`
*   **활용**: 패키지 설치 등 작업을 마친 컨테이너를 스냅샷으로 저장할 때 사용. (단, 프로덕션에서는 `Dockerfile` 사용 권장)

---

## 3. Docker Network

### 1) 개요
격리된 컨테이너 간의 네트워크 연결 및 통신을 지원합니다.
*   **docker0**: 도커 설치 시 생성되는 기본 브리지 네트워크.
*   기본적으로 컨테이너는 172.x.x.x 대역의 IP를 할당받습니다.

### 2) 네트워크 모드와 명령어
*   `docker network ls`: 네트워크 목록 확인.
*   `docker network create [이름]`: 사용자 정의 브리지 네트워크 생성. (권장)
    *   사용자 정의 네트워크를 사용하면 컨테이너 이름(DNS)으로 서로 통신 가능.
*   `docker network connect/disconnect`: 실행 중인 컨테이너 연결/해제.

---

## 4. 다중 컨테이너 연동 실습

### 1) WordPress 구축 (App + DB)
WordPress(웹)와 MySQL(DB) 컨테이너를 연결하여 서비스 구축.

1.  **네트워크 생성**:
    ```bash
    docker network create wordpressnet
    ```

2.  **MySQL 컨테이너 실행** (네트워크 연결):
    ```bash
    docker run --name mysql -dit --net=wordpressnet \
      -e MYSQL_ROOT_PASSWORD=password \
      -e MYSQL_DATABASE=wordpressdb \
      -e MYSQL_USER=user \
      -e MYSQL_PASSWORD=password \
      mysql
    ```

3.  **WordPress 컨테이너 실행** (네트워크 연결 및 DB 정보 입력):
    ```bash
    docker run --name wordpress -dit --net=wordpressnet -p 8080:80 \
      -e WORDPRESS_DB_HOST=mysql \
      -e WORDPRESS_DB_NAME=wordpressdb \
      -e WORDPRESS_DB_USER=user \
      -e WORDPRESS_DB_PASSWORD=password \
      wordpress
    ```

4.  **확인**: `http://localhost:8080` 접속.

### 2) Redmine 구축
프로젝트 관리 도구 Redmine도 유사한 방식으로 DB와 연동하여 구축 가능.
*   `REDMINE_DB_MYSQL`, `REDMINE_DB_USERNAME` 등의 환경 변수를 사용하여 DB 컨테이너와 연결.
