# 마이크로서비스 아키텍처와 Cloud Native (0128)

## 1. 비즈니스 민첩성과 Cloud Native

### 1) 비즈니스 환경의 변화
*   **민첩성(Agility)**: 사용자 피드백을 반영해 끊임없이 서비스를 개선하는 능력. (예: 아마존의 초당 1.5회 배포)
*   **Cloud 인프라의 등장**:
    *   기존 온프레미스 방식은 서버 도입부터 OS 설치까지 수주~수개월 소요.
    *   Cloud는 클릭 몇 번으로 인프라 마련 가능 -> 스타트업 및 빠른 서비스 출시에 필수적.

### 2) Cloud에 적합한 애플리케이션
*   **가변 트래픽**: 스케일 업/다운이 빈번한 쇼핑몰 등.
*   **탄력적 확장**: 특정 서비스(모듈)만 확장이 필요한 마이크로서비스 구조 애플리케이션.

### 3) Cloud Friendly vs Cloud Native
*   **Cloud Friendly**: 기존 모놀리식 시스템을 단순히 클라우드에 올린 것. 비효율(전체 확장만 가능) 존재.
*   **Cloud Native**: 애초에 클라우드 환경에 최적화하여 독립적으로 분리/배포 가능하도록 설계된 애플리케이션.
*   **핵심 기술**: Container, Micro Service, Service Mesh, Immutable Infra, Declarative API.

## 2. Monolithic vs Microservice

### 1) Monolithic Architecture
*   하나의 단위로 개발되는 일체식 애플리케이션.
*   **특징**: 
    *   보통 3-Tier(UI, DB, Server) 구성.
    *   작은 변화에도 전체를 다시 빌드/배포해야 함.
    *   확장 시 전체 어플리케이션을 동시에 확장해야 함(비효율적).
    *   데이터베이스가 통합되어 있어 탄력적 대응이 어려움.

### 2) Microservice Architecture (MSA)
*   서버 측이 여러 개의 작은 서비스 조각으로 구성됨.
*   **특징**:
    *   각 서비스는 독립적인 인스턴스로 실행.
    *   업무 단위로 모듈 경계가 명확함.
    *   특정 기능만 독립적으로 빌드, 배포, 확장이 가능.
    *   **Polyglot**: 서비스별로 가장 적합한 언어와 DB를 선택 가능.
    *   서로 다른 팀이 소유권(개발 및 운영)을 가짐.

## 3. Microservice의 발전과 특징

### 1) 발전 흐름
`구조적 방법론` -> `객체 지향` -> `CBD (Component Based)` -> `SOA (Service Oriented)` -> `MSA (Microservice)`
*   **SOA와 차이점**: SOA는 이론적/개념적 접근이 강했으나, MSA는 클라우드 기술(가상화, 컨테이너) 발전으로 이를 실현시킨 구체적인 성공 모델(Amazon, Netflix 등)임.

### 2) MSA의 핵심 정의
1.  **Small Services**: 여러 개의 작은 서비스 집합.
2.  **Independent Process**: 각 서비스는 개별 프로세스에서 실행.
3.  **Lightweight Communication**: HTTP API 등 가벼운 통신 사용.
4.  **Automated Deployment**: 자동화된 배포.
5.  **Polyglot & Decentralized**: 중앙 관리 최소화, 다양한 기술 스택 허용.
6.  **Data Separation**: 서비스별 저장소 분리 (API를 통해서만 데이터 접근).

---

## 4. Microservice 도입을 위한 4가지 변화

### 1) 조직의 변화: 업무 기능 중심 팀 (Cross-functional Team)
*   역할/기술별 분리가 아닌, 업무 기능을 중심으로 기획+개발+운영이 하나의 팀.
*   빠른 의사소통과 의사결정 가능.

### 2) 관리 체계의 변화: 자율적인 분권 거버넌스
*   **"You built it, you run it"** (Amazon): 만든 사람이 운영까지 책임.
*   중앙의 강력한 통제 대신 팀의 자율성 존중 (Polyglot 허용).

### 3) 개발 생명 주기의 변화: 프로젝트가 아니라 제품(Product) 중심
*   일회성 '프로젝트'가 아닌, 지속적으로 개선되는 '제품'으로 인식.
*   **Agile/DevOps**: 폭포수 모델 대신 점진적 반복 모델 채택. 
*   피드백을 통해 지속적으로 변화하고 개선.

### 4) 개발 환경의 변화: 인프라 자동화 (Infrastructure as Code)
*   마이크로서비스는 배포 대상이 많아 수동 배포 불가능.
*   **CI/CD 파이프라인**: 빌드 -> 테스트 -> 배포 과정을 자동화.
*   **IaC (Infrastructure as Code)**: 인프라 구성을 코드로 관리하여 복제 및 관리 효율화.

---

## 5. MSA의 주요 패턴 및 이슈

### 1) 데이터 일관성: 결과적 일관성 (Eventual Consistency)
*   서비스별 DB 분리로 인해 즉각적인 데이터 일관성(ACID) 보장이 어려움.
*   **해결책**:
    *   2단계 커밋(Distributed Tx)은 지양(성능/결합도 문제).
    *   **Event Driven Architecture**: 메시지 큐를 통한 비동기 이벤트 처리. 일시적 불일치는 허용하되, 결과적으로 일치시킴.
    *   **Saga Pattern / 보상 트랜잭션**: 실패 시 이전 작업을 취소하는 이벤트를 발행하여 정합성 유지. (예: 배송 실패 -> 주문 취소 이벤트 발행)

### 2) 위기 대응: 실패를 고려한 설계 (Design for Failure)
*   소프트웨어는 언제든 실패할 수 있음을 전제.
*   **Circuit Breaker 패턴**: 특정 서비스 장애 시 연결을 차단하여 전체 시스템으로의 장애 전파 방지.
*   **Chaos Engineering**: 넷플릭스의 '카오스 몽키'처럼 일부러 장애를 발생시켜 복원력을 테스트.

### 3) MSA 구성 요소 (CNCF)
*   **Infra**: Public/Private Cloud, VM, Container.
*   **Orchestration**: Kubernetes.
*   **Backing Service**:
    *   Persistence: RDBMS, NoSQL.
    *   Cache: Redis.
    *   Messaging: RabbitMQ, Kafka.
*   **Telemetry (Observability)**:
    *   **Logging**: ELK, EFK.
    *   **Trace (추적)**: Zipkin, Jaeger.
    *   **Monitoring**: Prometheus, Grafana.
*   **CI/CD**: Jenkins, GitLab CI, ArgoCD 등.

### 4) 플랫폼 패턴
*   **API Gateway**: 단일 진입점 제공, 인증/인가, 라우팅.
*   **BFF (Backend For Frontend)**: 프론트엔드 환경(Web, Mobile 등)에 맞춰 별도 백엔드 구성.
*   **인증/인가**: 세션(Redis 공유) 또는 토큰(JWT) 기반 처리.

---

## 6. Pillars of Cloud Native

### 1) DevOps
*   개발(Dev)과 운영(Ops)의 협업 및 통합.
*   **Agile**: 변화에 대응, 동작하는 SW 중심, 고객 협업.
*   **Tool Chain**: PLAN -> CODE -> BUILD -> TEST -> PACKAGE -> RELEASE -> OPERATE -> MONITORING.

### 2) CI/CD
*   **CI (Continuous Integration)**: 지속적 통합. 코드 변경을 빈번하게 머지하고 빌드/테스트.
*   **CD (Continuous Delivery/Deployment)**: 지속적 제공/배포. 프로덕션까지의 배포 과정을 자동화.

### 3) Microservices
상호 독립적인 최소 구성 요소로 분할하여 개발.

### 4) Containers
애플리케이션과 실행 환경을 패키징하여 격리하는 기술. 이식성과 효율성 보장.
