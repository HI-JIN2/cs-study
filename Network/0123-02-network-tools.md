# 네트워크 확인을 위한 명령어

### 1) ping(Packet InterNet Groper)

- IP 네트워크를 통해 특정 목적지까지 네트워크가 잘 동작하고 있는지 확인하는 네트워크 명령어

- 상대방 호스트가 살아있는지 확인하는 것이 최대 목표지만 두 호스트 간의 통신을 위한 경로가 정상적으로 구성되어 있는지 함께 체크 가능

- ICMP(Internet Control Message Protocol) 이라는 인터넷 프로토콜을 사용하고 ICMP의 제어 메시지를 통해 네트워크 상태를 파악할 수 잇습니다.

- 명령어 형식

```bash
ping [옵션] 목적지IP주소
```

- 확장 ping을 이용하면 ping을 체크하는 출발지 IP를 지정할 수 있음

- **옵션**:

- 리눅스
-c 개수        : 몇 번 전송할 지를 설정하는데 기본은 무제한

-i 주기        : 기본 설정값은 1초이고 슈퍼 유저의 경우 0.2 이하로 설정 가능

-I 인터페이스    : 패킷을 보낼 때 출발지 주소를 지정하는 것으로 실제 IP 값을 지정하거나 인터페이스 이름을 지정

-s 패킷사이즈    : 패킷의 크기로 기본 설정 값은 56 바이트인데 ICMP 헤더가 추가로 붙어서 64바이트를 송신

- 윈도우
-n 개수        : 몇 번 전송할 지를 설정하는데 기본은 4개

-t        : 무제한 전송

-r 홉수        : 홉의 경로를 기록(최대 9홉)

-S 인터페이스    : 패킷을 보낼 때 출발지 주소를 지정하는 것으로 실제 IP 값을 지정하거나 인터페이스 이름을 지정

-l 패킷사이즈    : 패킷의 크기로 기본 설정 값은 32 바이트

- 리눅스에서 ping을 사용해 목적지 8.8.8.8 로 100바이트 크기의 ping 패킷을 2회 보내기

```bash
ping 8.8.8.8 -c 2 -s 100
```

### 2) tcping(윈도우)

- ping은 목적지 단말까지의 중간 경로에 문제가 발생한 경우 icmp error 메시지를 활용해 라우팅 문제가 발생한 경우 일부 파악이 가능

- 목적지 단말이 잘 살아있고 중간 경로에 문제가 없더라도 실제 서비스를 위해사용되는 서비스 포트가 정상 상태인지 ping 만으로는 확인할 수 없습니다.

- 출발지 와 목적지 사이에 방화벽과 같은 보안 장비에서 막히지 않았는지, 목적지 운영체제에서 운영체제 방화벽이 동작해서 차단하는 것은 아닌지 확인해야 하는 경우가 많습니다,

- 명령어 형식

tcping [옵션] 목적지주소

- 기본 실행 프로그램은 아니라서 받아서 설치

- https://www.elifulkerson.com/projects/tcping.php 에서 exe 파일을 다운로드 받아서 사용

- **옵션**:

-n 개수
-t
-i 주기
serverport

- ping www.naver.com 명령을 사용하면 ping이 돌아오지 않는데 이것만으로 naver.com의 80번 포트가 열린것인지 닫힌것인지 확인 불가하고 tcping www.naver.com을 이용하면 확인 가능

### 3) traceroute/tracert

- 출발지부터 통신하거나 목적지까지의 네트워크 경로를 확인할 때 사용하는 명령

- 목적지까지 도달하지 못하는 경우 어느 구간에 문제가 발생했는지 찾을 때 사용

- **기본 형식**

```bash
traceroute [옵션] 목적지주소
```

tracert [옵션] 목적지주소
- **옵션**:

- 리눅스
-i : icmp 기반
-T: TCP SYN 으로 수행
-n: IP를 도메인이 아닌 숫자 형식으로 표시
-p port: 특정 포트를 지정해서 수행
-s 소스주소: 출발지 IP 변경

-윈도
-d: 도메인이 아닌 숫자 형식으로 표시
-h 최대홉수: 대상 검색을 위한 최대 홉수

- ***로 보여지는 것은 보안 때문에 icmp 메시지 나 udp 패킷을 차단하는 경우

### 4) tcptraceroute

- traceroute는 경로 정보만 확인 가능

- 서비스 포트가 사용 가능한 지 확인

- 기본적으로 제공되지 않아서 설치해서 사용

우분투: apt install traceroute
윈도우: https://www.elifukerson.com/projectes/tcproute.php

- 명령어 형식

```bash
tcproute [옵션] [목적지주소]
```

- **옵션**:

-p PORT: 서비스 포트 지정
-d: 숫자 형태로 IP를 출력
--http: HTTP Request를 보내 접속 확인

```bash
tcproute -p 80 www.google.com
```

### 5) netstat

- 서버의 네트워크 상태 확인에 이용

- TCP 확인

```bash
netstat -ant4

netstat -s -p TCP
```

- 필터링

```bash
netstat -ant4 | grep LISTENING

netstat -an | find "LISTENING"
```

### 6) ss(socket statistics)

- netstat 보다 결과를 빠르게 확인할 수 있고 더 다양한 정보를 조회할 수 있습니다.

- ss [옵션] [필터]

- **옵션**:

-a    전체 소켓
-l    LINSTENING
-i     소켓에 대한 자세한 정보
-p    현재 소켓에서 사용 중인 프로세스 표시
-n    서비스 이름이 아닌 실제 포트 번호로 서비스 포트를 표기
-4, 6    IPv4 와 IPv6 것만 조회
-s    프로토콜 별 통계 표시
-t    TCP
-u    UDP

- **실습**

```bash
ss -lp: 현재 대기중인 소켓의 프로세스 이름을 전부 출력
```

### 7) nslookup

- ip를 찾고자 할 때 사용

- set type=레코드 를 이용해서 조회 가능

레코드(A, AAAAn ANY, MX, NS, PTR)

### 8) telnet

### 9) 서비스를 테스트 할 때 접근이 불가능한 경우

- **이유**:

- 도착지 단말이 꺼져 있거나 네트워크에 정상적으로 연결되어 있지 않은 경우
- 도착지 단말의 네트워크 설정에 문자가 있는 경우
    출발지로부터 해당 서비스가 동작 중인 서버까지의 경로가 정상적으로 잡혀있지 않은 경우
    보안 장비에 의해서 차단된 경우
    도착지 단말의 방화벽이나 iptables와 같은 보안 기능에서 차단된 경우

- 추가적인 테스트

- 경로의 문제라면 ping 테스트 와 traceroute 명령어를 이용해서 문제 파악이 가능
- 보안 장비에 차단된 경우

```bash
ping 과 traceroute 가지고 어느정도 확인 가능
```

보안 장비의 위치를 안다면 보안 장비를 지나는 경우와 그렇지 않은 경우로 나누어서 테스트

단말의 방화벽 기능을 일시적으로 내리고 테스트 수행

```bash
netstat 와 ss 명령어를 이용해서 서비스가 정상적으로 동작하고 있는지 파악
```
