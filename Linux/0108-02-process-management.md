# Process Management

## 1. 프로세스 관리

### 1) 프로세스

- **개요**:

- 실행 중인 프로그램
- 리눅스는 다중 프로세스 시스템: 여러 개의 프로세스를 동시에 실행
- 프로세스는 운영에 필요한 다양한 기능을 수행하는 프로세스도 있고 사용자가 실행한 프로그램인 사용자 프로세스도 존재
- 프로세스는 부모-자식 관계를 가짐
필요에 따라 부모 프로세스는 자식 프로세스를 생성하고 그 자식은 또 다른 자식 프로세스를 생성할 수 있습니다.
- 부모 프로세스가 없는 프로세스는 리눅스 시스템을 부팅할 대 스케줄러가 실행한 프로세스인 systemd 와 kthreadd 입니다.

- 프로세스 번호

- 각 프로세스는 고유한 번호를 가지는데 이것을 PID(Process IDentifier)라고 합니다.
- 1번 부터 시작하고 프로세스가 실행되면서 1씩 증가
- systemd 가 1번이고 kthreadd 가 2번입니다.
- 유닉스에서는 1번 프로세스가 init 프로세스 이지만 우분투의 경우 init의 기능을 systemd로 변경

- 프로세스 종류

- 일반적인 프로세스는 자신이 수행할 작업을 전부 수행하면 종료됨

- 데몬 프로세스
특정 서비스를 제공하기 위해 리눅스 커널에 의해 실행되기 때문에 서비스라고도 합니다.
평소에는 대기 상태로 있다가 서비스 요청이 들어오면 서비스를 제공
서버라고 불리우는 서비스는 거의 데몬

- 고아 프로세스
자식 프로세스는 종료되면 부모 프로세스로 돌아가지만 자식 프로세스가 아직 실행 중인데 부모 프로세스가 종료되면 자식 프로세스는 고아 프로세스
리눅스는 고아 프로세스의 새로운 부모 프로세스로 1번 프로세스를 지정해서 고아 프로세스가 작업을 마치고 종료될 수 있게 합니다.

- 좀비 프로세스
자식 프로세스는 자신의 작업을 종료하면 종료 정보를 부모 프로세스에게 보내고 이 정보를 받으면 부모 프로세스는 자식 프로세스를 프로세스 테이블 목록에서 제거해야 하는데 실행을 종료했는데도 프로세스 테이블 목록에 남아있는 경우

자식 프로세스의 종료 정보를 부모 프로세스가 읽어가기를 기다리는 상태

프로세스 목록에는 defunct 라고 나옵니다.

나중에 이런 프로세스가 쌓이면 프로세스 테이블 목록이 가득 차서 더 이상 프로세스를 생성하지 못하는 상태가 될 수 있습니다.

좀비 프로세스는 kill 명령으로 삭제할 수 없으며 SIGCHIL 시그널을 부모 프로세스에 보내서 정리하도록 하던가 부모 프로세스 자체를 종료해야 합니다.

### 2) 프로세스 관리

- 프로세스 목록 확인

- 형식: ps [옵션]
- 옵션

유닉스 옵션
-e: 실행 중 인 모든 프로세스 확인
-f: 자세한 정보
-u uid: 특정 유저가 실행한 것만 확인
-p pid: pid에 해당하는 프로세스 정보 확인

BSD옵션
a: 터미널에서 실행시킨 것
u: 상세 정보
x: 모든 프로세스 정보

```bash
ps -ef | grep bash
```

- 프로세스 종료

- kill 이나 pkill 명령
- 프로세스에 시그널을 보내서 프로세스를 종료
- 시그널 종류: kill -l
- kill 명령
형식: kill [-시그널] PID

많이 사용하는 시그널
2: 인터럽트 시그널
9: 프로세스 강제 종료
15: 프로세스 와 관련된 파일들을 정리하고 종료하는데 종료되지 않는 프로세스가 있을 수 있음

- 실습
터미널 하나에서 man ps 명령 수행

다른 터미널을 열어서 ssh에 접속한 후 pgrep -x man 으로 man의 PID를 확인
kill 검색된PID

- pkill 명령
프로세스 이름으로 종료
동일한 이름의 모든 프로세스가 종료
유사한 명령으로 killall 이 있음

- 프로세스 정보를 주기적으로 출력

- top

### 3) 작업 제어

- 포그라운드 작업

- 사용자가 입력한 명령이 실행되어 결과가 출력될 때 까지 기다리는 방식으로 처리되는 프로세스
sleep 100 : 100초 동안 대기

- 백그라운드 작업

- 명령의 처리가 끝나는 것 과 상관없이 곧바로 프롬프트를 출력해서 다른 작업을 수행할 수 있도록 하는 것
- 명령의 실행의 시간이 오래 걸리거나 명령을 실행한 후 다른 작업을 할 필요가 있을 때 사용
- 명령 뒤에 &를 붙여주면 됩니다.
sleep 100 &: 100초 동안 대기
- 백그라운드 작업을 만들 때 무엇인가를 출력하는 경우 내용을 출력할 때 현재 작업 내용과 겹쳐져서 출력이 될 수 있습니다.
백그라운드 작업에서 출력은 화면이 아니라 파일에 출력하는 것이 바람직합니다.

```bash
find / -name passwd > pw.dat 2>&1 &
```

- **jobs**:

- 백그라운드 작업을 모두 조회
- 형식: jobs [%작업 번호]
%번호: 해당 번호의 작업 정보를 출력
%+: 작업 순서가 + 인 작업 정보를 조회
%-: 작업 순서가 -인 작업 정보를 조회

- jobs
[1]+  Running                 sleep 100 &

[1]: 작업 번호
+: 가장 최근에 접근한 작업
-: +작업 바로 전에 접근한 작업
공백: 그 이외의 작업

Running: 작업 상태 중에서 실행 중
Stopped: CTRL+z 등 으로 실행이 일시 중지 된 상태
Done: 작업이 완료
Terminated: 강제로 종료된 상태

sleep 100 &: 작업 내용
